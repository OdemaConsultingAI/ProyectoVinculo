### Archivo de pruebas HTTP para validar las nuevas validaciones y seguridad
### Puedes usar este archivo con extensiones como REST Client en VS Code

@baseUrl = http://localhost:3000
@token = tu_token_aqui

### 1. Health Check
GET {{baseUrl}}/api/health

### 2. Test Registro - Email inválido (debe fallar)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "email-invalido",
  "password": "123456",
  "nombre": "Test"
}

### 3. Test Registro - Contraseña corta (debe fallar)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "123",
  "nombre": "Test"
}

### 4. Test Registro - Contraseña sin letras (debe fallar)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "123456",
  "nombre": "Test"
}

### 5. Test Registro - Nombre inválido (debe fallar)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "test123",
  "nombre": "T"
}

### 6. Test Registro - Válido (debe funcionar)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "test123",
  "nombre": "Test User"
}

### 7. Test Login - Email inválido (debe fallar)
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "email-invalido",
  "password": "test123"
}

### 8. Test Login - Sin contraseña (debe fallar)
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": ""
}

### 9. Test Rate Limiting - Múltiples intentos de login (el 6to debe fallar)
POST {{baseUrl}}/api/auth/login
Content-Type: application/json

{
  "email": "test@example.com",
  "password": "wrongpassword"
}

### 10. Test Sanitización - Email con espacios (debe normalizarse)
POST {{baseUrl}}/api/auth/register
Content-Type: application/json

{
  "email": "  TEST@EXAMPLE.COM  ",
  "password": "test123",
  "nombre": "Test User"
}

### 11. Test Crear Contacto - Sin autenticación (debe fallar)
POST {{baseUrl}}/api/contacto
Content-Type: application/json

{
  "nombre": "Test Contact",
  "telefono": "1234567890"
}

### 12. Test Crear Contacto - Con autenticación pero teléfono inválido (debe fallar)
POST {{baseUrl}}/api/contacto
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Test Contact",
  "telefono": "123"
}

### 13. Test Actualizar Contacto - ID inválido (debe fallar)
PUT {{baseUrl}}/api/contacto/invalid-id
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Updated Contact"
}

### ============================================
### RUTAS DE TEST (tabla test)
### Sustituye @token por el token que devuelve el login (ej. test 6 o 8)
### Sustituye @testId por el _id que devuelve "Test POST válido" para PUT/DELETE
### ============================================
@testId = aqui_el_id_del_registro_creado

### 14. Test GET /api/test - Sin token (debe fallar 401)
GET {{baseUrl}}/api/test

### 15. Test GET /api/test - Con token (debe listar registros)
GET {{baseUrl}}/api/test
Authorization: Bearer {{token}}

### 16. Test POST /api/test - Sin token (debe fallar 401)
POST {{baseUrl}}/api/test
Content-Type: application/json

{
  "nombre": "Prueba",
  "valor": "123"
}

### 17. Test POST /api/test - Sin nombre (debe fallar 400)
POST {{baseUrl}}/api/test
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "valor": "solo valor"
}

### 18. Test POST /api/test - Válido (crear registro; copia el _id para PUT/DELETE)
POST {{baseUrl}}/api/test
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Mi registro de prueba",
  "valor": "abc",
  "activo": true
}

### 19. Test PUT /api/test/:id - ID inválido (debe fallar)
PUT {{baseUrl}}/api/test/invalid-id
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Actualizado",
  "activo": false
}

### 20. Test PUT /api/test/:id - Válido (usa el _id del POST anterior en @testId)
PUT {{baseUrl}}/api/test/{{testId}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "nombre": "Nombre actualizado",
  "valor": "nuevo valor",
  "activo": false
}

### 21. Test DELETE /api/test/:id - ID inválido (debe fallar)
DELETE {{baseUrl}}/api/test/invalid-id
Authorization: Bearer {{token}}

### 22. Test DELETE /api/test/:id - Válido (borra el registro; usa @testId)
DELETE {{baseUrl}}/api/test/{{testId}}
Authorization: Bearer {{token}}
